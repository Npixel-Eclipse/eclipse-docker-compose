syntax = "proto3";
package setting;

import "Common/setting_common.proto";
import "Common/callback.proto";

option java_multiple_files = true;
option java_package = "eclipse.proto.server.setting";
option java_outer_classname = "SettingServiceProto";

message SettingCommand {
  oneof command {
    Load load = 1;
    Save save = 2;
    List list = 3;
    Replace replace = 4;
    Query query = 5;
  }

  message List {
    string reply_topic = 1;
  }

  message Replace {
    string reply_topic = 1;
    repeated common.Setting settings = 2;
  }

  message Load {}
  message Save {}

  /**
   * Query에 대한 response 값은 kafka header에 SettingResponse로 전달됨
   * key는 "SettingResponse"
   */
  message Query {
    repeated string key = 1;
    common.CallbackCommand callback = 2;
  }
}

message ServerSettingEvent {
  string character_uuid = 1;
  ServerSettings settings = 2;

  message ServerSettings {
    repeated ServerSetting values = 1;
  }

  message ServerSetting {
    string key = 1;
    common.SettingValue value = 2;
    string property = 3;
  }
}

message SettingResponse {
  ResultCode result_code = 1;

  oneof response {
    Query query = 10;
  }

  enum ResultCode {
    SUCCESS = 0;
    FAIL = 1;
  }

  message Query {
    repeated Setting settings = 1;
    message Setting {
      string key = 1;
      optional common.SettingValue value = 2;
    }
  }
}

message SettingCache {
  message SettingsDto {
    map<string, common.SettingValue> values = 1;
  }

  int64 account_entity_id = 1;
  int64 character_entity_id = 2;
  string character_uuid = 3;
  map<int64, common.SettingValue> settings = 4;
  bool dirty = 100;
}
