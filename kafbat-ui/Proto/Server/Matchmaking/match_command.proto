syntax = "proto3";

option java_multiple_files = true;
option java_package = "eclipse.proto.server.matchmaking.match";
option java_outer_classname = "ServerMatchmakingMatchCommandProto";

// .을 넣고 싶지만 rust tonic에서 지원을 안해줌.
package matchmaking_match_command;

import "google/protobuf/empty.proto";
import "google/protobuf/timestamp.proto";
import "Common/property.proto";

message MatchmakingMatchCommand {
  oneof command {
    // internal

    // from matchmaking
    MatchCommand.CreateMatch create_match = 100;
    MatchCommand.DeleteMatch delete_match = 101;

    // from battle
    BattleMatchCommand.OnBattlegroundSessionCreated on_battleground_session_created = 200;
  }
}

message MatchCommand {
  message CreateMatch {
    int64 matchmaking_id = 1;
    optional int64 dungeon_id = 3;
    repeated Team team = 2;

    string home_battle_name = 10;
    string battle_name = 11;

    message Team {
      int64 team_id = 1;
      repeated Player player = 2;
    }

    message Player {
      int64 account_id = 4;
      string character_uuid = 2;
      repeated common.Property property = 3;
    }
  }

  message DeleteMatch {
    reserved 1, 2;

    Reason reason = 3;
    repeated Team team = 4;
    repeated Player player = 5;

    enum Reason {
      FINISH = 0;
      UNKNOWN = 1;
    }

    enum Result {
      WIN = 0;
      LOSE = 1;
      DRAW = 2;
      PENALTY = 3;
    }

    message Team {
      int64 team_id = 1;
      Result result = 2;
      int64 score = 3;
    }

    message Player {
      int64 team_id = 1;
      int64 account_id = 2;
      string character_uuid = 3;
      repeated common.Property property = 4;
      Result result = 5;
    }
  }
}

message BattleMatchCommand {
  message OnBattlegroundSessionCreated {
    string battleground_session_id = 1;
    int64 game_duration_in_seconds = 2; // 시작 전 대기 시간 + 게임 진행 시간 + 종료 후 대기 시간
  }
}
