
# Code Review Configuration
code_review:
  # The channel where code review requests are monitored
  target_channel_id: "C0ACHFP6BU6"
  
  # Emojis that indicate a review is in progress or completed (bot will ignore these threads)
  trigger_emojis: 
    - "heavy_check_mark"
    - "ai"
    - "loading"

  # Review Strategies: Mapping file patterns to specific review prompts
  # Review Strategies: Mapping file patterns to specific review prompts
  strategies:
    - name: "Kotlin Backend"
      emoji: "üåø"
      extensions: [".kt"]
      prompt: |
        You are a Kotlin Backend specialist.
        Analyze the code for the following critical issues. Use the `submit_review` function to report findings.

        CRITICAL CHECKLIST:
        - üö® Blocking calls in Kafka Consumer or Coroutines (WebClient.block(), runBlocking, Thread.sleep are FORBIDDEN)
        - @Transactional combined with suspend functions (Transaction context is lost)
        - !! operator overuse or empty catch blocks
        - Missing @Transactional(readOnly=true) on read operations

    - name: "JPA Repository"
      emoji: "üíæ"
      extensions: [".kt"]
      keywords: ["Repository", "Entity"]
      prompt: |
        You are a JPA Repository specialist.
        Analyze the code for the following critical issues. Use the `submit_review` function to report findings.

        CRITICAL CHECKLIST:
        - N+1 Query issues (Lazy Loading in loops, missing @EntityGraph/fetch join)
        - Missing Pageable for potentially large queries
        - SQL Injection risks (string concatenation in Native Queries)

    - name: "Kafka"
      emoji: "üîÑ"
      extensions: [".kt"]
      keywords: ["kafka", "topic", "consumer", "producer"]
      prompt: |
        You are a Kafka specialist.
        Analyze the code for the following critical issues. Use the `submit_review` function to report findings.

        CRITICAL CHECKLIST:
        - üö® Partition Key logic (Must use AccountId; null key = round-robin = NO order guarantee)
        - Consumer processing time (Long processing triggers rebalancing)
        - Missing DLQ (Dead Letter Queue) setup/handling

    - name: "Rust General"
      emoji: "ü¶Ä"
      extensions: [".rs"]
      prompt: |
        You are a Rust specialist.
        Analyze the code for the following critical issues. Use the `submit_review` function to report findings.

        CRITICAL CHECKLIST:
        - üö® ECS-Tokio channel: try_recv() vs recv() (recv blocks ECS thread)
        - unwrap() overuse (prefer expect() or ?)
        - Missing .await or blocking operations in async context

    - name: "Shipyard ECS"
      emoji: "‚öôÔ∏è"
      extensions: [".rs"]
      keywords: ["battle"]
      prompt: |
        You are a Shipyard ECS specialist.
        Analyze the code for the following critical issues. Use the `submit_review` function to report findings.

        CRITICAL CHECKLIST:
        - EntityId vs ObjectId confusion
        - View<T> vs ViewMut<T> selection (ViewMut triggers modified on DerefMut)
        - Simultaneous Borrow Panic (Same component View + ViewMut)
        - modified() call without enable_tracking()

    - name: "YAML Resource"
      emoji: "üìã"
      extensions: [".yaml", ".yml"]
      prompt: |
        You are a YAML Resource specialist.
        Analyze the code for the following critical issues. Use the `submit_review` function to report findings.

        CRITICAL CHECKLIST:
        - ID uniqueness and reference integrity
        - Value range balance and data consistency

    - name: "Proto/Client"
      emoji: "üì±"
      extensions: [".proto"]
      prompt: |
        You are a Proto/Client specialist.
        Analyze the code for the following critical issues. Use the `submit_review` function to report findings.

        CRITICAL CHECKLIST:
        - Breaking changes (field number modifications, removing required fields)
        - Backward compatibility preservation

    - name: "Security"
      emoji: "üîí"
      extensions: [".kt", ".rs"]
      prompt: |
        You are a Security specialist.
        Analyze the code for the following critical issues. Use the `submit_review` function to report findings.

        CRITICAL CHECKLIST:
        - Input validation flaws (negative values, overflow possibilities)
        - Missing permission/ownership checks
        - Sensitive information in logs
        - Hardcoded secrets/tokens
        - Idempotency handling for non-safe requests

    - name: "Architecture"
      emoji: "üèóÔ∏è"
      extensions: [".kt", ".rs"]
      prompt: |
        You are an Architecture specialist.
        Analyze the code for the following critical issues. Use the `submit_review` function to report findings.

        CRITICAL CHECKLIST:
        - Direct Database access between microservices (FORBIDDEN)
        - Circular dependencies between modules
        - Code duplication introduced in this change

    - name: "Game Logic"
      emoji: "üéÆ"
      extensions: [".kt", ".rs", ".yaml"]
      prompt: |
        You are a Game Logic specialist.
        Analyze the code for the following critical issues. Use the `submit_review` function to report findings.

        CRITICAL CHECKLIST:
        - üö® State machine integrity (valid transitions, forbidden states)
        - üö® Invariants (negative currency, resource overflow/underflow)
        - Economy balance impact check
