$schema: http://json-schema.org/draft-04/schema#
type: array
items:
  type: object
  additionalProperties: false
  required:
    - Id
    - Name
    - Size
    - NpcType
    - Asset
  properties:
    Id:
      type: integer
      minimum: 1
    
    #네이밍 규칙
    #지역구분_분류_세부명칭 (ex. Varitan_Magic_SoldierStaff)
    #지역: Varitan(바리탄), Eldar(엘다르), Castia(카스티아), Deco(데코), ...
    #분류: Melee(근거리), Range(원거리), Magic(마법), Boss(보스), Merchant(상점), ...
    
    #프로퍼티 입력 규칙
    #NPC에 입력한 Property: ture 인 값은 BaseBuff의 값과 합하여 적용한다.
    #소환수: Master의 능력치를 우선 받아온 후 중복된 npc.yaml의 프로퍼티를 덮은 후 BaseBuff와 합하여 적용한다.


    Name:
      type: string
      pattern: ^[A-Z][A-Za-z0-9_]*$
    Comment:
      type: string
    DesignComment:
      type: string
    
    #AreaCommentRegion 권역 명칭
    #AreaCommentType 필드/던전/인스턴스
    #AreaCommentGround 지역(사냥터) 명칭
    #AreaCommentRating 몬스터 등급 (일반/네임드/어비스/보스)
    #NpcSpawnComment 몬스터 스폰 그룹 코멘트 (A/B/핫스팟 등으로 사용됨)
    #NpcChangeComment 몬스터 스폰 명칭 변경 관련 코멘트 (작업 이후 삭제 예정)
    ExtraNpcGroup:
      type: integer
      default: 0
    AreaCommentRegion:
      type: string
    AreaCommentType:
      type: string
    AreaCommentGround:
      type: string
    AreaCommentRating:
      type: string
    NpcSpawnComment:
      type: string
    NpcChangeComment:
      type: string  
    PortalSkill:
      type: string
      ref: skill
    Ai:
      type: string
      ref: ai
      visible: true
    BaseBuffs:
      type: array
      items:
        type: string
        ref: buff
    # 지속 시간이 있는 Basebuff
    TimedBuffs:
      type: array
      items:
        type: object
        additionalProperties: false
        required:
          - Buff
          - Duration
        properties:
          Buff:
            type: string
            ref: buff
          Duration:
            type: integer
    BaseProperties:
      type: array
      items:
        type: object
        additionalProperties: false
        required:
          - PropertyPreset
        properties:
          PropertyPreset:
            type: string
            ref: property_preset
    #NPC의 이름
    DescriptionName:
      type: string
      ref: description
    #NPC Nameplate에서 이름 위에 위치한 칭호
    DescriptionTitle:
      type: string
      ref: description
    #NPC의 종류
    ## Battleground : 전장에서 AI로 사용할 NPC (ViewList에 아무도 없어도(=Sleep이어도) AI가 동작함)
    ## Merchant : Merchant 컬럼을 바라봄 (상품 정보 불러움)
    ## NonMerchant : 상인이 아닌 기능 NPC (ex. 창고), NpcRole 컬럼을 바라봄
    NpcType:
      type: string
      ref: npc_type
      property: true
    #NPC가 차지하는 Cell 크기 행렬로 표시하며 왼쪽이 가로. ConvertCell등의 값도 넣어줘야함
    Size:
      type: array
      items:
        type: integer
        default: 1
        minimum: 1
    # Address로 설정된 Drop item을 생성하지 않음
    IgnoreAddressItem:
      type: boolean
    #모델링 리소스 경로: /Game/Characters/파일명.파일명
    Asset:
      type: string
      ref: character_model
    BossNpc:
      type: boolean
    #문서에는 내용이 없으나 Normal로 모든 몬스터가 사용중
    AggroType:
      type: string
    #기능성 NPC 기능을 정의하는 컬럼
    #NPC 네임플레이트 색상 설정
    #NPC 아이콘 미니맵 출력 여부
    NpcRole:
      type: string
      ref: npc_role
    ContainQuestEffect:
      type: boolean
      default: false
    #주로 기능성 NPC에 사용, 에셋 경로 입력, 어떤 아이콘을 보여줄지
    InteractionIconAsset:
      type: string
    #해당 npc가 점유하는 셀의 성격을 정의
    ConvertCell:
      type: string
      enum:
        - Movable
        - LowWall
        - HighWall
        - SightWall # 시야 캐시 적용 이후 서버에서 기능 제거됨 (클라 코드에서 사용 중)
    # 월드맵에서 몬스터 공격 타입을 출력하기 위해 사용됨 (None: 근거리 / Melee: 근거리 / Range: 원거리 / Magic: 마법 ) 
    DisplayAttackType:
      type: string
      enum:
        - None
        - Melee
        - Range
        - Magic
    #NPC가 공격이 가능한지
    IsAttackable:
      type: integer
    # 최종 경험치 계산 공식
    ExperienceCalc:
      type: string
      formula: true
    # 보너스를 제외한 경험치 계산 공식, 클라에서 보너스 경험치 표기 위해 서버에서는 (ExperienceCalc - ExperienceBaseCalc) 전송함
    ExperienceBaseCalc:
      type: string
      formula: true
    # 각 몬스터별 경험치 상수
    ExperienceValue:
      type: integer
    #안개속에서 보이지 않게
    HideInFog:
      type: boolean
      default: true
    # NPC의 Nameplate를 영구적으로 표시한다.
    NameTitleAlways:
      type: boolean
    #기본 공격, SKill.yaml과 연동
    NormalAttack:
      ref: skill
      type: string
      property: true
    NpcMapIcon: #리소스 경로 가이드: /Game/UIIcon/MapSymbol/파일명.파일명
      type: string
    NpcShopIcon: #shop 초상화 리소스 경로 가이드: /Game/UIIcon/파일명.파일명
      type: string
    #플레이어가 감지할 수 있는 범위 (말풍선 기능에서 사용하는 기능)
    #0으로 설정 시 말풍선이 작동하지 않는다.
    DetectionRange:
      type: integer

    #말풍선을 끝까지 모두 출력한 이후 대기 시간
    SpeechCooltime:
      type: integer
      default: 2

    #말풍선에 출력하기 위한 컬럼
    #GroupId 순서대로 출력하며 같은 GroupId 안에서는 랜덤하게 출력한다.
    #단, GroupId 내의 아이템이 하나인 경우 확률을 무시하고 무조건 출력함.
    #Duration: 말풍선 출력 시간
    #Probability: 말풍선 출력 확률 (여러개를 입력하여 확률에 따라 말풍선 출력 가능)
    Speech:
      type: array
      items:
        type: object
        additionalProperties: false
        properties:
          GroupId:
            type: integer
          Description:
            type: string
            ref: description
          Duration:
            type: integer
          Probability:
            type: string
            default: 100%
            pattern: ^[1-9]?[0-9](\.[0-9][0-9]*)?%$
    
    #몬스터 그룹 지정, 퀘스트 처치 그룹으로 사용
    NpcGroup:
      type: string
      ref: npc_group
    # 상인, 상인 그룹 지정. 둘다 지정되어 있을 경우 상인 그룹 우선 적용.
    Merchant:
      type: string
      ref: item_merchant
    Building:
      type: string
      ref: building

    #재질
    Material:
      type: string
      ref: character_material
      default: Normal
    Teleport:
      type: string
      ref: worldmap_area

    # 소환 시 월드맵 아이콘 표기
    BroadcastWorldMapIcon:
      type: boolean
      default: false

    # 소환 시 Address에 적용할 Welcome Skill, Npc가 사망하는 경우 제거된다.
    # 같은 지역에 같은 웰컴 스킬로 같은 버프는 하나만 들어간다는 가정이 있어서
    # 같은 몬스터 여러개 소환할 경우 그것들이 제거될 때 하나만 제거되어도 모든 웰컴 스킬 버프가 제거될 것이다.
    AddressWelcomeSkills:
      type: array
      items:
        type: string
        ref: skill

    HpBarInfo: #해당 데이터가 없을 경우에는 NPC가 타깃되었을 때 HP바 숨김 처리 됨.
      type: object
      additionalProperties: false
      properties:
        TargetHUDStyle:
          type: string
          enum:
            - None
            - Default
            - Special
            - WorldBoss
        SecretMode:
          type: boolean
          default: false
      # NPC의 기본 스탯 정보
      # BuffProperties 와 거의 같은 식으로 동작함
      # BaseBuff, TimedBuff는 실제 버프로써 작동해야 하능 기능이 필요한 경우에만 사용하고,
    # 스탯 정의를 위해서는 이 것을 쓰는 것을 권장함.
    NpcProperties:
      type: array
      items:
        type: object
        additionalProperties: false
        required:
          - PropertyName
          - PropertyValue
        columnize:
          column: PropertyName
          value: PropertyValue
        properties:
          PropertyName:
            type: string
            ref: property
          PropertyValue:
            type:
              - integer
              - boolean
              - string
    CopyMasterProperties:
      type: array
      items:
        type: string
        ref: property_group

    # NPC 인터렉션
    NpcInteraction:
      type: string
      ref: npc_interaction

    # 아이템 자동 분배 설정
    # true일 경우, drop_item의 AutoRewardMethod=None인 아이템들은 자동 분배 아이템(인벤토리)
    # false일 경우, drop_item의 AutoRewardMethod=None인 아이템들이 드롭 아이템
    ItemAutoDistribute:
      type: boolean
      default: false
